<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Tracyå®å®ä»Šå¤©åƒä»€ä¹ˆå¥½å‘¢ ğŸ°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background-color: #fff8f0;
      font-family: "Chalkboard SE", "Comic Sans MS", "PingFang SC", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 18px;
      margin: 0;
    }

    .container {
      width: 360px;
      background: #ffffff;
      padding: 20px 16px 24px;
      border-radius: 25px;
      box-shadow: 0px 6px 18px rgba(255, 193, 158, 0.4);
      text-align: center;
      border: 3px dashed #ffd4a0;
      position: relative;
    }

    .container::before {
      content: "ğŸ“";
      position: absolute;
      top: -22px;
      left: 18px;
      font-size: 26px;
    }

    .container::after {
      content: "ğŸ­";
      position: absolute;
      top: -22px;
      right: 18px;
      font-size: 26px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 4px;
      font-weight: 700;
      color: #ff7e6e;
    }

    .subtitle {
      color: #c59f78;
      font-size: 13px;
      margin-bottom: 12px;
    }

    .inputArea textarea {
      width: 94%;
      height: 80px;
      border-radius: 14px;
      border: 2px dotted #ffc9a3;
      padding: 10px;
      resize: none;
      font-size: 13px;
      outline: none;
      background: #fffdf7;
      color: #a56942;
    }

    .inputHint {
      font-size: 12px;
      color: #c79b6a;
      margin-top: 4px;
    }

    .btn {
      margin-top: 12px;
      background: #ffb7c5;
      color: white;
      padding: 10px 28px;
      border-radius: 30px;
      border: 0;
      font-size: 15px;
      cursor: pointer;
      transition: .25s;
      box-shadow: 0 5px 12px rgba(255,150,160,0.4);
      font-weight: bold;
    }

    .btn:hover { transform: translateY(-2px); }
    .btn:active { transform: translateY(2px); box-shadow: none; }

    .wheel-wrap {
      margin: 16px auto 8px;
      width: 260px;
      height: 260px;
      position: relative;
      display: none;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 6px solid #ffd999;
      overflow: hidden;
      position: relative;
      background: #fffce6;
      box-shadow: inset 0px 0px 6px rgba(255,178,100,0.5);
    }

    /* æ—‹è½¬çš„é’ˆï¼šä»åœ†å¿ƒä¼¸å‡ºå»ï¼Œé’ˆè½¬ç›˜ä¸åŠ¨ */
    .needle {
      position: absolute;
      top: 52%;
      left: 51.5%;
      width: 6px;
      height: 80px;                 /* é’ˆå¤šé•¿è‡ªå·±è°ƒ */
      background: #ff6f6f;
      border-radius: 999px;
      transform-origin: 50% 100%;   /* åº•éƒ¨ = åœ†å¿ƒ */
      transform: translate(-50%, -100%) rotate(0deg);
      z-index: 11;
      filter: drop-shadow(0px 3px 5px rgba(255,120,120,0.4));
    }

    /* é’ˆå°–å°ä¸‰è§’ */
    .needle::after {
      content: "";
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 20px solid #ff6f6f;
    }

    .option-list {
      margin: 4px auto 4px;
      text-align: left;
      font-size: 12px;
      color: #a56942;
      max-width: 260px;
      line-height: 1.5;
    }

    .option-item {
      display: flex;
      align-items: center;
      margin-bottom: 2px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      margin-right: 6px;
      flex-shrink: 0;
    }

    .resultMsg {
      font-size: 15px;
      color: #ff6f6f;
      font-weight: bold;
      min-height: 24px;
      margin-top: 4px;
    }

    .heart {
      position: fixed;
      bottom: 25px;
      font-size: 22px;
      opacity: 0;
      animation: floatUp 1.6s ease-out;
    }

    @keyframes floatUp {
      0% { transform: translateY(0px); opacity: 1; }
      100% { transform: translateY(-85px); opacity: 0; }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Tracyå®å®ä»Šå¤©åƒä»€ä¹ˆå¥½å‘¢ ğŸ°</h1>
  <div class="subtitle">è¾“å…¥é€‰é¡¹ï¼Œå†ç”Ÿæˆè½¬ç›˜ ğŸ’–</div>

  <div class="inputArea">
    <textarea id="inputBox" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š
å¯¿å¸
é¥ºå­
é£Ÿå ‚
åˆ˜æ–‡ç¥¥
ä¸æƒ³åƒ..."></textarea>
    <div class="inputHint">æ”¯æŒ 3 ~ 12 é¡¹å†…å®¹ âœ¨</div>
  </div>

  <button class="btn" id="createBtn">ç”Ÿæˆè½¬ç›˜ ç›˜ğŸ½</button>

  <div class="wheel-wrap" id="wheelWrap">
    <div class="wheel" id="wheel"></div>
    <div class="needle" id="needle"></div>
  </div>

  <div class="option-list" id="optionList"></div>

  <button class="btn" id="spinBtn" style="display:none">å¼€å§‹æŠ½å– âœ¨</button>

  <div class="resultMsg" id="resultMsg"></div>
</div>

<script>
let options = [];
let spinning = false;

const createBtn = document.getElementById("createBtn");
const spinBtn = document.getElementById("spinBtn");
const wheelWrap = document.getElementById("wheelWrap");
const resultMsg = document.getElementById("resultMsg");
const wheel = document.getElementById("wheel");
const inputBox = document.getElementById("inputBox");
const optionList = document.getElementById("optionList");
const needle = document.getElementById("needle");

// ç³–æœè‰²è°ƒ
const colors = [
  "#FFD6E0", "#FFEDC4", "#C4F5E6", "#C6E3FF", "#FFE0F8",
  "#F7FFD4", "#FFD6B8", "#D9C2FF", "#FFF3CD", "#FFCAD4",
  "#E2F0CB", "#F1C0E8"
];

createBtn.onclick = () => {
  const txt = inputBox.value.trim();
  if (!txt) return alert("å†™ç‚¹ä¸œè¥¿å˜›ï¼ğŸ¥º");

  options = txt.split("\n").map(v => v.trim()).filter(v => v);
  if (options.length < 3) return alert("è‡³å°‘ 3 ä¸ªé€‰é¡¹å–”ï½");
  if (options.length > 12) return alert("æœ€å¤š 12 ä¸ªï¼Œä¸ç„¶å¤ªæŒ¤å•¦ï½");

  drawWheel();
  renderOptionList();

  wheelWrap.style.display = "block";
  spinBtn.style.display = "inline-block";

  // é‡ç½®é’ˆä½ç½®
  needle.style.transition = "none";
  needle.style.transform = "translate(-50%, -100%) rotate(0deg)";
  void needle.offsetWidth;
};

function drawWheel() {
  const sliceAngle = 360 / options.length;

  // conic-gradient çœŸæ­£ç­‰åˆ†åœ†æ‰‡å½¢
  const segments = options.map((opt, i) => {
    const start = i * sliceAngle;
    const end   = (i + 1) * sliceAngle;
    const color = colors[i % colors.length];
    return `${color} ${start}deg ${end}deg`;
  });

  // from -90degï¼šè®© 0 åº¦åœ¨æ­£ä¸Šæ–¹
  wheel.style.background = `conic-gradient(from -90deg, ${segments.join(", ")})`;
}

function renderOptionList() {
  optionList.innerHTML = "";
  options.forEach((opt, index) => {
    const item = document.createElement("div");
    item.className = "option-item";

    const dot = document.createElement("span");
    dot.className = "dot";
    dot.style.background = colors[index % colors.length];

    const text = document.createElement("span");
    text.textContent = opt;

    item.appendChild(dot);
    item.appendChild(text);
    optionList.appendChild(item);
  });
}

// æŠ½å¥–ï¼šå…ˆéšæœºé€‰ indexï¼Œå†æŠŠé’ˆè½¬è¿‡å»ï¼ˆè§†è§‰å’Œç»“æœå®Œå…¨ä¸€è‡´ï¼‰
// æŠ½å¥–ï¼šå…ˆéšæœºé€‰ indexï¼Œå†æŠŠé’ˆè½¬è¿‡å»ï¼ˆè§†è§‰å’Œç»“æœå®Œå…¨ä¸€è‡´ï¼‰
spinBtn.onclick = () => {
Â  if (spinning) return;
Â  spinning = true;
Â  spinBtn.disabled = true;

Â  const sliceAngle = 360 / options.length;

Â  // 1. çœŸæ­£è¢«é€‰ä¸­çš„ index
Â  const chosenIndex = Math.floor(Math.random() * options.length);

Â  // 2. è¯¥æ‰‡å½¢â€œä¸­å¿ƒè§’åº¦â€ï¼ˆä¸ CSS çš„ from -90deg ä¿æŒä¸€è‡´ï¼š0Â° åœ¨æ­£ä¸Šæ–¹ï¼Œé¡ºæ—¶é’ˆï¼‰
Â  // åŸå§‹è®¡ç®—æ˜¯ä»å³ä¾§ 0Â° é¡ºæ—¶é’ˆå¼€å§‹ï¼Œæ‰€ä»¥éœ€è¦å‡å» 90Â° çš„åç§»é‡
Â  let centerAngle = chosenIndex * sliceAngle + sliceAngle / 2;
Â  centerAngle -= 90; // ä¿®æ­£è§’åº¦ï¼Œä½¿å…¶ 0Â° åœ¨æ­£ä¸Šæ–¹

Â  // 3. å¤šè½¬å‡ åœˆå†åœåœ¨è¿™ä¸ªè§’åº¦
Â  // ä½¿ç”¨ 360 * 5 + centerAngleï¼ŒcenterAngle å¿…é¡»æ˜¯æœ€ç»ˆåœç•™çš„æœ‰æ•ˆè§’åº¦
Â  const finalRotation = 360 * 5 + centerAngle;

Â  // 4. é‡ç½®é’ˆåˆ° 0Â°
Â  needle.style.transition = "none";
Â  needle.style.transform = "translate(-50%, -100%) rotate(0deg)";
Â  void needle.offsetWidth;

Â  // 5. å¼€å§‹æ—‹è½¬
Â  needle.style.transition = "transform 4s cubic-bezier(.15,1,.3,1)";
Â  needle.style.transform = `translate(-50%, -100%) rotate(${finalRotation}deg)`;

Â  // 6. ç»“æŸåå±•ç¤ºç»“æœ
Â  setTimeout(() => {
Â  Â  const chosen = options[chosenIndex];
Â  Â  resultMsg.innerHTML = `ğŸ€ ä»Šå¤©å°±é€‰ï¼š${chosen} ğŸ’`;
Â  Â  floatingHeart();

Â  Â  spinning = false;
Â  Â  spinBtn.disabled = false;
Â  }, 4000);
};

function floatingHeart() {
  const heart = document.createElement("div");
  heart.className = "heart";
  heart.innerHTML = ["ğŸ’–", "âœ¨", "ğŸŒ¸", "ğŸ’—"][Math.floor(Math.random() * 4)];
  heart.style.left = (50 + Math.random() * 16 - 8) + "%";
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 1600);
}
</script>

</body>
</html>
